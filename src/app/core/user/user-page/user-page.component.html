<app-portal>
  <ng-container class="render">
    <div>
      <button class="btn btn--blue" (click)="back()">Back</button>
      <span class="item-title">{{user?.name}} - <span>{{user?.title}}</span></span>
    </div>
    <div class="tabs tabs--vertical">
      <ol class="tabs__links tabs__links--vertical">
        <li data-revealId="details" data-default="true" appTabView>Details</li>
        <li data-revealId="update" appTabView appPermitted [table]="'user'" [operation]="'update'">Update details</li>
        <li data-revealId="add-modules" appTabView appPermitted [table]="'user_module'" [operation]="'create'"
          (click)="getModules()">Module access</li>
        <li data-revealId="danger" appTabView appPermitted [table]="'user'" [operation]="'delete'">Danger zone</li>
      </ol>
      <div class="tabs__content tabs__content--vertical">
        <div data-revealId="details">
          <app-loader *ngIf="isGettingBasicDetails"></app-loader>
          <table class="details-table" *ngIf="!isGettingBasicDetails">
            <tbody>
              <tr>
                <td>Name</td>
                <td>{{user?.name | titlecase}}</td>
              </tr>
              <tr>
                <td>Title</td>
                <td>{{user?.title | titlecase}}</td>
              </tr>
              <tr>
                <td>Username</td>
                <td>{{user?.username}}</td>
              </tr>
              <tr>
                <td>Type</td>
                <td>{{user?.type | titlecase}}</td>
              </tr>
              <tr>
                <td>Status</td>
                <td>{{user?.state | titlecase}}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div data-revealId="update" appPermitted [table]="'user'" [operation]="'update'">
          <form #userForm="ngForm" (ngSubmit)="updateUser(userForm.value)" ngNativeValidate>
            <div class="input">
              <fieldset>
                <label for="name">Name of the user</label>
                <input type="text" id="name" name="name" [ngModel]="user?.name" required autocomplete="off">
              </fieldset>
            </div>
            <div class="input">
              <fieldset>
                <label for="title">Work title</label>
                <input type="text" id="title" name="title" [ngModel]="user?.title" required autocomplete="off">
              </fieldset>
            </div>
            <div class="input">
              <fieldset>
                <label for="username">Username</label>
                <input type="text" id="username" name="username" [ngModel]="user?.username" required autocomplete="off">
              </fieldset>
            </div>
            <div class="input">
              <fieldset>
                <label for="type">Type of user</label>
                <select name="type" id="type" required autocomplete="off" [ngModel]="user?.type">
                  <option value="Student">Student</option>
                  <option value="Teacher">Teacher</option>
                  <option value="Parent">Parent</option>
                  <option value="Employee">Employee</option>
                  <option value="Admin">Admin</option>
                </select>
              </fieldset>
            </div>
            <div class="submit">
              <fieldset>
                <button class="btn btn--blue" [disabled]="userForm.pristine || isUpdating">Update</button>
                <app-loader *ngIf="isUpdating"></app-loader>
              </fieldset>
            </div>
          </form>
        </div>
        <div data-revealId="add-modules" appPermitted [table]="'user_module'" [operation]="'create'">
          <app-loader *ngIf="isGettingModules"></app-loader>
          <form #modulesAddForm="ngForm" (ngSubmit)="addModules()" *ngIf="!isGettingModules">
            <span></span>
            <table>
              <thead>
                <tr>
                  <th>Section</th>
                  <th>Create</th>
                  <th>Update</th>
                  <th>Delete</th>
                  <th>View</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let section of sections">
                  <td>{{section.title}}</td>
                  <td>
                    <input type="checkbox" name="{{section.table}}_CREATE" id="{{section.table}}_CREATE"
                      [ngModel]="section.create" value="CREATE" (change)="onPermChange(section.table, $event.target)">
                  </td>
                  <td>
                    <input type="checkbox" name="{{section.table}}_UPDATE" id="{{section.table}}_UPDATE"
                      [ngModel]="section.update" value="UPDATE" (change)="onPermChange(section.table, $event.target)">
                  </td>
                  <td>
                    <input type="checkbox" name="{{section.table}}_DELETE" id="{{section.table}}_DELETE"
                      [ngModel]="section.delete" value="DELETE" (change)="onPermChange(section.table, $event.target)">
                  </td>
                  <td>
                    <input type="checkbox" name="{{section.table}}_SELECT" id="{{section.table}}_SELECT"
                      [ngModel]="section.select" value="SELECT" (change)="onPermChange(section.table, $event.target)">
                  </td>
                </tr>
              </tbody>
            </table>
            <div class="submit">
              <fieldset>
                <button class="btn btn--blue"
                  [disabled]="this.selectedPermissions.length === 0 || isSavingPermissions">Save</button>
                <app-loader *ngIf="isSavingPermissions"></app-loader>
              </fieldset>
            </div>
          </form>
        </div>
        <div data-revealId="danger" appPermitted [table]="'user'" [operation]="'delete'">Danger zone</div>
      </div>
    </div>
  </ng-container>
</app-portal>